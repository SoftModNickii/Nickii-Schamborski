<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nickii Schamborski</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400&family=Source+Serif+Pro:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>N</text></svg>">
    
    <!-- CSS -->
    <link rel="stylesheet" href="../css/style.css?v=20260104-1700">
    <link rel="stylesheet" href="../css/subpage.css?v=20260104-1700">
</head>
<body class="subpage">
    
    <!-- Construction Notice -->
    <div class="construction-notice">
        <span class="construction-icon">üöß</span>
        Website under construction
    </div>
    
    <!-- Header with Name + Horizontal Navigation -->
    <header class="subpage-header">
        <div class="header-top">
            <h1><a href="../index.html">Nickii Schamborski</a></h1>
            <div class="header-actions">
                <a href="../pages/cv.html" class="cv-btn">CV</a>
                <a href="mailto:studio@schamborski.com" class="email-icon" title="studio@schamborski.com">
                    <svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2 0C0.9 0 0 0.9 0 2V14C0 15.1 0.9 16 2 16H18C19.1 16 20 15.1 20 14V2C20 0.9 19.1 0 18 0H2ZM2 2H18L10 7L2 2ZM2 4.37L10 9.37L18 4.37V14H2V4.37Z" fill="currentColor"/>
                    </svg>
                </a>
            </div>
        </div>
        
        <nav class="horizontal-nav">
            <a href="#" data-filter="all" class="filter-btn active">All</a>
            <a href="#" data-filter="works" class="filter-btn">Works</a>
            <a href="#" data-filter="shows" class="filter-btn">Shows</a>
            <a href="#" data-filter="practice" class="filter-btn">Practice & Teachings</a>
            <a href="#" data-filter="education" class="filter-btn">Education</a>
            <a href="#" data-filter="fellowships" class="filter-btn">Fellowships & Awards</a>
            <a href="#" data-filter="press" class="filter-btn">Press</a>
        </nav>
    </header>

    <main class="grid-page">
        <div class="grid-container" id="grid-container">
            <!-- Cards will be generated by JavaScript -->
        </div>
    </main>

    <!-- Detail View Modal -->
    <div id="detail-modal" class="detail-modal">
        <div class="detail-content">
            <button class="detail-close">&times;</button>
            <div id="detail-body"></div>
        </div>
    </div>

    <!-- Search Tool (expanding from side) -->
    <div class="search-tool" id="search-tool">
        <button class="search-toggle" id="search-toggle" aria-label="Search">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/>
                <path d="M20 20L16.5 16.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </button>
        <div class="search-panel" id="search-panel">
            <input type="text" id="search-input" placeholder="Search..." />
        </div>
    </div>

    <footer>
        <p>
            <a href="../impressum.html">Impressum</a> | 
            <a href="../datenschutz.html">Datenschutz</a> | 
            <a href="mailto:studio@schamborski.com">Contact</a>
        </p>
    </footer>

    <!-- JavaScript -->
    <script>
    let allContent = [];
    let currentFilter = 'all';

    // Load JSON data
    fetch('../data/content.json')
        .then(response => response.json())
        .then(data => {
            allContent = data;
            
            // Check URL for initial filter
            const urlParams = new URLSearchParams(window.location.search);
            const filterParam = urlParams.get('filter');
            if (filterParam) {
                currentFilter = filterParam;
                updateActiveFilter(filterParam);
            }
            
            renderCards(currentFilter);
        })
        .catch(error => {
            console.error('Error loading content:', error);
            document.getElementById('grid-container').innerHTML = '<p>Error loading content. Check console.</p>';
        });

    // NEUE SMOOTH TRANSITION LOGIC!
    function renderCards(filter) {
        const container = document.getElementById('grid-container');
        const currentCards = Array.from(container.children);
        
        // 1. Fade out existing cards (staggered)
        currentCards.forEach((card, index) => {
            setTimeout(() => {
                card.style.opacity = '0';
                card.style.transform = 'scale(0.9)';
            }, index * 40);
        });
        
        // 2. Wait for fadeout, then replace content
        setTimeout(() => {
            // Filter content
            let filtered = filter === 'all' 
                ? allContent 
                : allContent.filter(item => item.categories.includes(filter));
            
            // Sort by year (newest first) - ALWAYS chronological
            filtered.sort((a, b) => {
                const getYear = (yearStr) => parseInt(yearStr.split('/')[0]);
                return getYear(b.year) - getYear(a.year);
            });
            
            // Clear container
            container.innerHTML = '';
            
            // 3. Add new cards (staggered fade in)
            filtered.forEach((item, index) => {
                const card = createCard(item);
                card.style.opacity = '0';
                card.style.transform = 'scale(0.9)';
                container.appendChild(card);
                
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                }, index * 60);
            });
            
        }, currentCards.length * 40 + 300);
    }

    // Create card element
    function createCard(item) {
        const card = document.createElement('div');
        card.className = 'grid-card';
        
        // Set background image directly on card
        if (item.image) {
            card.style.backgroundImage = `url(../${item.image})`;
        }
        
        const inner = document.createElement('div');
        inner.className = 'card-inner';
        
        // Front - Title overlay
        const front = document.createElement('div');
        front.className = 'card-front';
        front.innerHTML = `<h3>${item.title}</h3>`;
        
        // Back - Slide up overlay
        const back = document.createElement('div');
        back.className = 'card-back';
        
        let backHTML = `<p class="card-year">${item.year}</p>`;
        backHTML += `<p class="card-type">${item.type}</p>`;
        if (item.specs) backHTML += `<p class="card-specs">${item.specs}</p>`;
        if (item.institution) backHTML += `<p class="card-institution">${item.institution}</p>`;
        
        // Add "Full Details" button for items with descriptions
        if (item.description || item.collaborators || item.exhibited_works || item.exhibited_at) {
            backHTML += `<button class="detail-btn" data-id="${item.id}">Full Details ‚Üí</button>`;
        }
        
        // Add CSL export button for press items
        if (item.categories.includes('press') && item.csl) {
            backHTML += `<button class="cite-btn" data-id="${item.id}">Cite this ‚Üí</button>`;
        }
        
        back.innerHTML = backHTML;
        
        inner.appendChild(front);
        inner.appendChild(back);
        card.appendChild(inner);
        
        return card;
    }

    // Filter button clicks
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            const filter = btn.getAttribute('data-filter');
            currentFilter = filter;
            updateActiveFilter(filter);
            renderCards(filter);
            
            // Update URL
            const newUrl = `${window.location.pathname}?filter=${filter}`;
            window.history.pushState({filter: filter}, '', newUrl);
        });
    });

    // Update active filter
    function updateActiveFilter(filter) {
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.getAttribute('data-filter') === filter) {
                btn.classList.add('active');
            }
        });
    }

    // Detail Modal Functions
    document.addEventListener('click', (e) => {
        // Open detail view
        if (e.target.classList.contains('detail-btn')) {
            const itemId = e.target.getAttribute('data-id');
            const item = allContent.find(i => i.id === itemId);
            if (item) showDetailModal(item);
        }
        
        // Download CSL citation
        if (e.target.classList.contains('cite-btn')) {
            const itemId = e.target.getAttribute('data-id');
            const item = allContent.find(i => i.id === itemId);
            if (item && item.csl) downloadCSL(item);
        }
        
        // Close modal
        if (e.target.classList.contains('detail-close') || e.target.id === 'detail-modal') {
            closeDetailModal();
        }
    });

    function showDetailModal(item) {
        const modal = document.getElementById('detail-modal');
        const body = document.getElementById('detail-body');
        
        let html = `<h2>${item.title}</h2>`;
        html += `<p class="detail-year">${item.year}</p>`;
        html += `<p class="detail-type">${item.type}</p>`;
        
        // Image gallery
        if (item.image || item.images) {
            const imageList = item.images || [item.image];
            if (imageList.length > 0 && imageList[0]) {
                html += `<div class="detail-gallery">`;
                html += `<div class="gallery-main">`;
                html += `<img src="../${imageList[0]}" alt="${item.title}" class="gallery-image active" data-index="0">`;
                imageList.forEach((img, idx) => {
                    if (idx > 0) {
                        html += `<img src="../${img}" alt="${item.title}" class="gallery-image" data-index="${idx}" style="display:none;">`;
                    }
                });
                html += `</div>`;
                
                if (imageList.length > 1) {
                    html += `<div class="gallery-nav">`;
                    html += `<button class="gallery-prev">‚Üê</button>`;
                    html += `<span class="gallery-counter">1 / ${imageList.length}</span>`;
                    html += `<button class="gallery-next">‚Üí</button>`;
                    html += `</div>`;
                    html += `<div class="gallery-thumbnails">`;
                    imageList.forEach((img, idx) => {
                        html += `<img src="../${img}" class="gallery-thumb${idx === 0 ? ' active' : ''}" data-index="${idx}">`;
                    });
                    html += `</div>`;
                }
                
                // Add image credit if available
                if (item.image_credit) {
                    html += `<p class="image-credit">${item.image_credit}</p>`;
                }
                
                html += `</div>`;
            }
        }
        
        if (item.description) {
            html += `<div class="detail-description">`;
            
            // Show bilingual descriptions for works
            if (item.categories.includes('works') && item.description_de) {
                html += `<div class="lang-section">`;
                html += `<h3 class="lang-label">English</h3>`;
                html += `<p>${item.description}</p>`;
                html += `</div>`;
                html += `<div class="lang-section">`;
                html += `<h3 class="lang-label">Deutsch</h3>`;
                html += `<p>${item.description_de}</p>`;
                html += `</div>`;
            } else {
                html += `<p>${item.description}</p>`;
            }
            
            html += `</div>`;
        }
        
        if (item.specs) {
            html += `<p class="detail-specs"><strong>Specs:</strong> ${item.specs}</p>`;
        }
        
        if (item.institution) {
            html += `<p class="detail-institution"><strong>Institution:</strong> ${item.institution}</p>`;
        }
        
        if (item.collaborators && item.collaborators.length > 0) {
            html += `<div class="detail-collaborators"><strong>Collaborators:</strong><ul>`;
            item.collaborators.forEach(collab => {
                html += `<li>${collab.name}${collab.role ? ` (${collab.role})` : ''}</li>`;
            });
            html += `</ul></div>`;
        }
        
        if (item.credits) {
            html += `<div class="detail-credits"><strong>Credits:</strong><ul>`;
            Object.entries(item.credits).forEach(([role, name]) => {
                if (name) html += `<li><em>${role}:</em> ${name}</li>`;
            });
            html += `</ul></div>`;
        }
        
        if (item.exhibited_at && item.exhibited_at.length > 0) {
            html += `<div class="detail-exhibitions"><strong>Exhibited at:</strong><ul>`;
            item.exhibited_at.forEach(showId => {
                const show = allContent.find(i => i.id === showId);
                if (show) {
                    html += `<li>${show.title} (${show.year})</li>`;
                }
            });
            html += `</ul></div>`;
        }
        
        if (item.exhibited_works && item.exhibited_works.length > 0) {
            html += `<div class="detail-works"><strong>Exhibited works:</strong><ul>`;
            item.exhibited_works.forEach(workId => {
                const work = allContent.find(i => i.id === workId);
                if (work) {
                    html += `<li>${work.title} (${work.year})</li>`;
                }
            });
            html += `</ul></div>`;
        }
        
        if (item.tags && item.tags.length > 0) {
            html += `<div class="detail-tags">`;
            item.tags.forEach(tag => {
                html += `<span class="tag">${tag}</span>`;
            });
            html += `</div>`;
        }
        
        if (item.link) {
            html += `<a href="${item.link}" target="_blank" class="detail-link">Visit Link ‚Üí</a>`;
        }
        
        // Add video link at the bottom as plain text link
        if (item.video_link) {
            html += `<div class="video-link-container"><a href="${item.video_link}" target="_blank" class="video-link">${item.video_link}</a></div>`;
        }
        
        body.innerHTML = html;
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeDetailModal() {
        const modal = document.getElementById('detail-modal');
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    function downloadCSL(item) {
        const cslData = item.csl;
        const blob = new Blob([JSON.stringify(cslData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${item.id}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeDetailModal();
        }
    });

    // Gallery navigation
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('gallery-next') || e.target.classList.contains('gallery-prev')) {
            const modal = document.getElementById('detail-body');
            const images = modal.querySelectorAll('.gallery-image');
            const counter = modal.querySelector('.gallery-counter');
            const thumbs = modal.querySelectorAll('.gallery-thumb');
            
            let currentIdx = parseInt(modal.querySelector('.gallery-image.active').dataset.index);
            
            if (e.target.classList.contains('gallery-next')) {
                currentIdx = (currentIdx + 1) % images.length;
            } else {
                currentIdx = (currentIdx - 1 + images.length) % images.length;
            }
            
            images.forEach(img => {
                img.classList.remove('active');
                img.style.display = 'none';
            });
            images[currentIdx].classList.add('active');
            images[currentIdx].style.display = 'block';
            
            thumbs.forEach(thumb => thumb.classList.remove('active'));
            thumbs[currentIdx].classList.add('active');
            
            if (counter) {
                counter.textContent = `${currentIdx + 1} / ${images.length}`;
            }
        }
        
        // Thumbnail click
        if (e.target.classList.contains('gallery-thumb')) {
            const modal = document.getElementById('detail-body');
            const images = modal.querySelectorAll('.gallery-image');
            const counter = modal.querySelector('.gallery-counter');
            const thumbs = modal.querySelectorAll('.gallery-thumb');
            const targetIdx = parseInt(e.target.dataset.index);
            
            images.forEach(img => {
                img.classList.remove('active');
                img.style.display = 'none';
            });
            images[targetIdx].classList.add('active');
            images[targetIdx].style.display = 'block';
            
            thumbs.forEach(thumb => thumb.classList.remove('active'));
            e.target.classList.add('active');
            
            if (counter) {
                counter.textContent = `${targetIdx + 1} / ${images.length}`;
            }
        }
    });

    // Search Tool Toggle
    const searchToggle = document.getElementById('search-toggle');
    const searchPanel = document.getElementById('search-panel');
    const searchInput = document.getElementById('search-input');
    const searchTool = document.getElementById('search-tool');

    searchToggle.addEventListener('click', () => {
        searchTool.classList.toggle('expanded');
        if (searchTool.classList.contains('expanded')) {
            setTimeout(() => searchInput.focus(), 300);
        }
    });

    // Search functionality
    searchInput.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase().trim();
        
        if (!query) {
            renderCards(currentFilter);
            return;
        }

        const container = document.getElementById('grid-container');
        const currentCards = Array.from(container.children);
        
        // Fade out
        currentCards.forEach((card, index) => {
            setTimeout(() => {
                card.style.opacity = '0';
                card.style.transform = 'scale(0.9)';
            }, index * 40);
        });
        
        setTimeout(() => {
            // Filter by search query
            let filtered = allContent.filter(item => {
                const searchableText = [
                    item.title,
                    item.type,
                    item.year,
                    item.specs,
                    item.institution,
                    item.description
                ].filter(Boolean).join(' ').toLowerCase();
                
                return searchableText.includes(query);
            });

            // Apply current category filter if not 'all'
            if (currentFilter !== 'all') {
                filtered = filtered.filter(item => item.categories.includes(currentFilter));
            }
            
            // Sort by year
            filtered.sort((a, b) => {
                const getYear = (yearStr) => parseInt(yearStr.split('/')[0]);
                return getYear(b.year) - getYear(a.year);
            });
            
            container.innerHTML = '';
            
            if (filtered.length === 0) {
                container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #999;">No results found</p>';
                return;
            }
            
            // Fade in
            filtered.forEach((item, index) => {
                const card = createCard(item);
                card.style.opacity = '0';
                card.style.transform = 'scale(0.9)';
                container.appendChild(card);
                
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                }, index * 60);
            });
        }, currentCards.length * 40 + 300);
    });

    // Close search when clicking outside
    document.addEventListener('click', (e) => {
        if (!searchTool.contains(e.target)) {
            searchTool.classList.remove('expanded');
        }
    });
</script>
</body>
</html>